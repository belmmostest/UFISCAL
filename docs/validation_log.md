# UFISCAL Model Validation Notes

## Simulation Sanity Checks
- `src/dgce_model/api/quick_simulation_enhanced.EnhancedQuickSimulation` baseline run (9% CIT, 75% compliance) now reports:
  - Corporate tax component ≈ AED 36.2 billion
  - Pre-compliance microsim tax ≈ AED 48.3 billion, of which ≈ AED 29.6 billion comes from oil & gas firms taxed at 55%
  - Average effective tax rate ≈ 0.775% (reflecting compliance-adjusted 6.75% statutory rate applied to positive-tax firms)
  - Macro impacts derived from data/elasticities: GDP impact ≈ +0.72 pp (decimal form propagated downstream as 0.0072) and employment responses follow the employment/GDP trend ratio from the sectoral panel
- Aggregate taxable profit generated by `_compute_corporate_tax` ≈ AED 268 billion (non-oil ≈ AED 214 billion, oil ≈ AED 54 billion), aligning with the calibrated macro base after sector filters and policy toggles.

## Profit Calibration Diagnostics
- `dgce_model.ogcore_firm.prepare_and_evaluate` enforces sector-level profit margins derived from national accounts (bounded between 0.07 and 0.21) before applying overall macro calibration targets.
- Electricity/water and mining sectors now respect empirical margins, preventing earlier 30%+ profit artefacts that drove corporate tax collections above AED 120 billion.

## Automated Test Suite
- `tests/test_openfisca_runner.py` verifies corporate tax logic for SMEs, free zones, and oil-sector rates.
- `tests/test_ogcore_firm.py` ensures the OG-Core profit pipeline matches the requested target margin while bounding sector-level deviations.
- `tests/test_comprehensive_analysis.py` exercises the comprehensive analysis API via dependency stubs, asserting presence of microsimulation output, revenue analysis, and dynamic paths.
- `tests/test_policy_shock_engine.py` confirms multi-year projections honour baseline growth trends instead of remaining flat.
- Execute with `pytest` (suite finishes in <1 s on local hardware).

## Dynamic Path Sanity Check
- `DataDrivenDGCEModel.simulate()` now passes trend growth (derived from the sectoral panel) and the inflation anchor to `PolicyShockEngine`. A baseline run with zero policy shock produces an increasing GDP path: `[1696071, 1789355, 1887769, …]` rather than a flat series.
